<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Breakout clone</title>
    <!-- boarder for canvas -->
    <style media="screen">
      canvas {
        border: 2px black solid;
      }
    </style>
  </head>
  <body>
    <canvas id="canvas" width="500" height="700"></canvas>
<script>

// get Image from the path
var getImage = function(path) {
  // Can initial img without 'var' as a global variable,
  // so we can know the values of img in console of browser,
  // such as width, height etc.
  var img = new Image();
  img.src = path
  return img
}

// Paddle
var Paddle = function() {
    var obj = {
      speed: 15,
      x: 150,
      y: 600,
    }
    obj.img = getImage('paddle.png')
    obj.moveLeft = function() {
      obj.x -= obj.speed
    }
    obj.moveRight = function() {
      obj.x += obj.speed
    }
    return obj
}

// Breakout_clone game body
var Game = function() {
  var obj = {
    keydowns: {},
    actions: {},
  }
  // paddle in game
  obj.paddle = new Paddle()

  obj.canvas = document.querySelector('canvas')
  obj.context = canvas.getContext('2d')

  // 1.events
  window.addEventListener('keydown', function(event){
    obj.keydowns[event.key] = true
  })
  window.addEventListener('keyup', function(event){
    obj.keydowns[event.key] = false
  })

  // 2.set each action nad keydown
  obj.setAction = function(key, func) {
    obj.keydowns[key] = false
    obj.actions[key] = func
  }

  // draw
  obj.draw = function() {
    obj.context.clearRect(0,0,obj.canvas.width,obj.canvas.height)
    obj.context.drawImage(obj.paddle.img,obj.paddle.x,obj.paddle.y)
  }

  // update
  obj.update = function() {
    // obtain a list of keys of array 'actions',
    // such as 'a','d' etc.
    var index = Object.keys(obj.actions)
    for (var i = 0; i < index.length; i++) {
      var k = index[i]
      if (obj.keydowns[k]) {
        obj.actions[k]()
      }
    }
  }
  // timer
  // set FPS as 30
  setInterval(function () {
    obj.update()
    obj.draw()
  }, 1000/30)
  return obj
}

// main function
var main = function() {

  // use for debug or catch key
  //var log = console.log.bind(console)
  var game = new Game()

  // set the actions I want
  game.setAction('a', function() {
    game.paddle.moveLeft()
  })
  game.setAction('d', function() {
    game.paddle.moveRight()
  })
}

main()
</script>
  </body>
</html>
